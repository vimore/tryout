include classpath("morphline/parsing_config.conf")

#windows_dhcp.date.timeZone : "PST"
dnsmasq_dhcp.date.timeZone: "UTC"

bluecoat_default.header = [
  "date",
  "time",
  "time-taken",
  "c-ip",
  "cs-username",
  "cs-auth-group",
  "x-exception-id",
  "sc-filter-result",
  "cs-categories",
  "cs(Referer)",
  "sc-status",
  "s-action",
  "cs-method",
  "rs(Content-Type)",
  "cs-uri-scheme",
  "cs-host",
  "cs-uri-port",
  "cs-uri-path",
  "cs-uri-query",
  "cs-uri-extension"
  "cs(User-Agent)",
  "s-ip",
  "sc-bytes",
  "cs-bytes",
  "x-virus-id"
]

syslog.sysloglogcollection.timezone_hook: [
  {
    pipe {
      id: customer_timezone_handler
      importCommands: ["org.kitesdk.**", "org.apache.solr.**", "com.securityx.**"]
      commands: [
        {
          addKeyValuesIfMissing {
            logCollectionTimeZone: "@{deviceNameOrIp}"
          }
        },
        {
          translate {
            field: logCollectionTimeZone
            dictionary: {
              "atl-ern-dhcpa": "US/Eastern"
              "aus-ern-dhcpa": "US/Eastern"
              "aus-ern-dhcpb": "US/Eastern"
              "WSPRDC112": "US/Eastern"
              "WSQADC013": "US/Eastern"
              "WSPRDC115": "US/mountain"
            }
            fallback: "US/Eastern"
          }
        }
      ]
    }
  }
]

syslog.sysloglogcollection.forwarder_cleaning: [
  {
    tryRules {
      catchExceptions: true
      throwExceptionIfAllRulesFailed: false
      rules: [
        {
          commands: [
            {
              addKeyValuesIfMissing {
                _syslogMessage: "@{syslogMessage}"
              }
            },
            {
              removeFields {
                blacklist: ["literal:syslogMessage"]
                whitelist: []
              }
            }
            {

              grokcmd {
                # broken by relocation of morphline config to resource
                #dictionaryFiles : [logcollection-grok-patterns]
                dictionaryString: """
                    ####################
                    # Syslog severity
                    FORWARDER 207\.\d{1,3}\.\d{1,3}\.\d{1,3}
                    SYSLOGHEADER \S+\s\S+
                    ##################
                    # GENERIC
                    DATAGREEDY .*
                  """
                #Oct 16 10:49:20 ciscopix %PIX-6-302015: B....
                expressions: {
                  _syslogMessage: """^\s%{FORWARDER}\s%{SYSLOGHEADER}\s%{DATAGREEDY:syslogMessage}"""
                }
                extract: true
                findSubstrings: true
                addEmptyStrings: false
              }
            }

          ]
        },
        # atl-ern-lb04-2-netscaler.example.
        # atl-ern-lb04-2-netscaler.example.com
        {
          commands: [
            {
              addKeyValuesIfMissing {
                _syslogMessage: "@{syslogMessage}"
              }
            },
            {
              removeFields {
                blacklist: ["literal:syslogMessage"]
                whitelist: []
              }
            }
            {

              grokcmd {
                # broken by relocation of morphline config to resource
                #dictionaryFiles : [logcollection-grok-patterns]
                dictionaryString: """
                    ####################
                    # Syslog severity
                    FORWARDER atl-ern-lb\d+-\d+-netscaler(\.[^\s\.]+)*
                    SYSLOGHEADER \S+\s\S+
                    ##################
                    # GENERIC
                    DATAGREEDY .*
                  """
                #Oct 16 10:49:20 ciscopix %PIX-6-302015: B....
                expressions: {
                  _syslogMessage: """^\s%{FORWARDER}\s%{SYSLOGHEADER}\s%{DATAGREEDY:syslogMessage}"""
                }
                extract: true
                findSubstrings: true
                addEmptyStrings: false
              }
            }

          ]
        },
        {
          commands: [
            {
              addKeyValuesIfMissing {
                syslogMessage: "@{_syslogMessage}"
              }
            }
          ]
        }
      ]

    }
  }
]

#commented out to enable all tests.
#windows_ad.accepted_event_ids = ["4624", "4625", "4648", "4672"]
