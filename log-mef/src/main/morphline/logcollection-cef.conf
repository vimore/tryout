morphlines : [
  {
    id: cefraw
    importCommands: ["org.kitesdk.morphline.**", "com.securityx.model.mef.morphline.**"]
    commands: [
      {
        harnessCmd {
          morphlineFile: "logcollection-cef.conf",
          morphlineId: "cefnew",
          transferFieldNamedToMessage: "message",
          messageFieldName: "syslogMessage"
        }
      }
    ]
  },
  {
    id : cefnew
    importCommands: [ "org.kitesdk.morphline.**", "com.securityx.model.mef.morphline.**"]
    commands : [
      {

        tsvq {
          inputFieldName : "syslogMessage",
          fieldSep : "|",
          quoteChar : "\"",
          trim : true,
          fieldNames : [
            "cefHeader",
            "cefDeviceVendor",
            "cefDeviceProduct",
            "cefDeviceVersion",
            "cefSignatureId",
            "cefEventName",
            "cefEventSeverity",
            "cefExtensionData"
          ]
        }
      },
      {
        grok {
          dictionaryString : """
            CEF_HDRPREFIX CEF
            CEF_HDRVERSION \d+
          """
          expressions : {
            cefHeader : """%{CEF_HDRPREFIX}:\s*%{CEF_HDRVERSION:cefHeaderVersion}"""
          }
          extract : true,
          findSubstrings : true,
          addEmptyStrings : false
        }
      },
      {
        #cefKvpSplitter  {
        cefKvpCommand  {
          inputFieldName : "cefExtensionData" ,
          #formatKeySet : ["cef", "WebProxyMef", "e8CustomCef"],
          trim : true
        }
      },
      {
        addKeyValuesIfMissing  {
          logSourceType : ["Cef"]
        }
      },
    ]
  },
  { 
    id : cef
    # Import all morphline commands in these java packages and their subpackages.
    # Other commands that may be present on the classpath are not visible to this
    # morphline.
    importCommands : [ "org.kitesdk.morphline.**", "com.securityx.model.mef.morphline.**"]
    commands : [
      {
        grok {
          dictionaryString : """
            CEF_HDRPREFIX CEF
            CEF_HDRVERSION \d+
            CEF_DEVVENDOR (?:(?:[^\|]*\\\|)*|[^\|]+)*
            CEF_DEVPRODUCT (?:(?:[^\|]*\\\|)*|[^\|]+)*
            CEF_DEVVERSION (?:(?:[^\|]*\\\|)*|[^\|]+)*
            CEF_SIGNATURE (?:(?:[^\|]*\\\|)*|[^\|]+)*
            CEF_NAME (?:(?:[^\|]*\\\|)*|[^\|]+)*
            CEF_SEVERITY \d+
            CEF_EXTENSION .*
          """
          #CEF:0|ForeScout Technologies|CounterAct|6.3.4|COMPLIANCE|host is compliant|1|cs1Label=Compliancy Policy Name cs2Label=Compliancy Policy Subrule Name cs3Label=Host Compliancy Status cs4Label=Compliancy Event Trigger cs1=Operating System  cs2=Updated cs3=yes cs4=CounterAct Action dmac=00:03:47:24:46:65 dst=10.10.1.4 dntdom=loglogicrocks.com dhost=wks-105 duser=Kevin_Mitchell dvc=1.1.1.1 dvchost=forescout-02 rt=1328814052000
          expressions : {
              syslogMessage : """%{CEF_HDRPREFIX}:%{CEF_HDRVERSION:cefHeaderVersion}\|%{CEF_DEVVENDOR:cefDeviceVendor}\|%{CEF_DEVPRODUCT:cefDeviceProduct}\|%{CEF_DEVVERSION:cefDeviceVersion}\|%{CEF_SIGNATURE:cefSignatureId}\|%{CEF_NAME:cefEventName}\|%{CEF_SEVERITY:cefEventSeverity}\|%{CEF_EXTENSION:cefExtensionData}"""
          }
          extract : true,
          findSubstrings : true,
          addEmptyStrings : false 
        }
      },
      {
        addKeyValuesIfMissing  {
            logSourceType : ["Cef"]
        }
      },
      {
        cefKvpSplitter  {
                  inputFieldName : "cefExtensionData" ,
                  formatKeySet : ["cef",  "WebProxyMef"],
                  trim : true
        }
      },
      {
        webProxyMefFormat {
            formatIdFromFieldName : "logSourceType",  #supposed to contain "cef"
            discardUnmappableFields : "false", 
            discardOriginalMappedFields :  "true"
            }
      }
    ]
  },
  {
    id : ceffromsyslogmissinghost
    importCommands : [ "org.kitesdk.morphline.**", "com.securityx.model.mef.morphline.**"]

    commands : [
      {
        grok {
            dictionaryString : """
            MONTHNUM (?:0?[1-9]|1[0-2])
            MONTHDAY (?:(?:0[1-9])|(?:[12][0-9])|(?:3[01])|[1-9]) 
            HOUR (?:2[0123]|[01]?[0-9])
            MINUTE (?:[0-5][0-9])
            # '60' is a leap second in most time standards and thus is valid.
            SECOND (?:(?:[0-5][0-9]|60)(?:[:.,][0-9]+)?)
            TIME (?!<[0-9])%{HOUR}:%{MINUTE}(?::%{SECOND})(?![0-9]) 
            CEF_DATE %{MONTHNUM}/%{MONTHDAY}/\d{4}\s%{TIME}
            HOST [^\s]+
            GREEDY .*
          """, 
             #10/31/2013 23:59:20 CEF:0|ForeScout Technologies|CounterAct|6.3.4|COMPLIANCE|host is compliant|1|cs1Label=Compliancy Policy Name cs2Label=Compliancy Policy Subrule Name cs3Label=Host Compliancy Status cs4Label=Compliancy Event Trigger cs1=Operating System  cs2=Updated cs3=yes cs4=CounterAct Action dmac=00:03:47:24:46:65 dst=10.10.1.4 dntdom=loglogicrocks.com dhost=wks-105 duser=Kevin_Mitchell dvc=1.1.1.1 dvchost=forescout-02 rt=1328814052000
            expressions : {
                #message : """%{CEF_DATE:syslogTime}\s(?:%{HOST:syslogHost}\s)?%{GREEDY:syslogMessage}"""
                message : """%{CEF_DATE:syslogTime}\s%{GREEDY:syslogMessage}"""
            }
          extract : true,
          findSubstrings : false,
          addEmptyStrings : false 
        }
      },
      { 
        harnessCmd  {
          morphlineFile : "logcollection-cef.conf"
          morphlineId : "cef"
          transferFieldNamedToMessage : "syslogMessage"
          messageFieldName : "syslogMessage"
        }
      }
    ]
  },
  {
    id : ceffromsyslog
    importCommands : [ "org.kitesdk.morphline.**", "com.securityx.model.mef.morphline.**"]

    commands : [
      {
        grok {
            dictionaryString : """
            MONTHNUM (?:0?[1-9]|1[0-2])
            MONTHDAY (?:(?:0[1-9])|(?:[12][0-9])|(?:3[01])|[1-9]) 
            HOUR (?:2[0123]|[01]?[0-9])
            MINUTE (?:[0-5][0-9])
            # '60' is a leap second in most time standards and thus is valid.
            SECOND (?:(?:[0-5][0-9]|60)(?:[:.,][0-9]+)?)
            TIME (?!<[0-9])%{HOUR}:%{MINUTE}(?::%{SECOND})(?![0-9]) 
            CEF_DATE %{MONTHNUM}/%{MONTHDAY}/\d{4}\s%{TIME}
            HOST [^\s]+
            GREEDY .*
          """, 
 
            #10/31/2013 23:59:20 CEF:0|ForeScout Technologies|CounterAct|6.3.4|COMPLIANCE|host is compliant|1|cs1Label=Compliancy Policy Name cs2Label=Compliancy Policy Subrule Name cs3Label=Host Compliancy Status cs4Label=Compliancy Event Trigger cs1=Operating System  cs2=Updated cs3=yes cs4=CounterAct Action dmac=00:03:47:24:46:65 dst=10.10.1.4 dntdom=loglogicrocks.com dhost=wks-105 duser=Kevin_Mitchell dvc=1.1.1.1 dvchost=forescout-02 rt=1328814052000
            expressions : {
                message : """%{CEF_DATE:syslogTime}\s(?:%{HOST:syslogHost}\s)?%{GREEDY:syslogMessage}"""
                #message : """%{CEF_DATE:syslogTime}\s%{GREEDY:syslogMessage}"""
            }
          extract : true,
          findSubstrings : false,
          addEmptyStrings : false 
        },
      },        
      { 
        harnessCmd  {
          morphlineFile : "logcollection-cef.conf"
          morphlineId : "cef"
          transferFieldNamedToMessage : "syslogMessage"
          messageFieldName : "syslogMessage"
        }
      }
    ]
  } 
]