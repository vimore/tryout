morphlines : [
  {
    id : logcollectionselector
    importCommands : [ "org.kitesdk.morphline.**", "com.securityx.model.mef.morphline.**"]

    commands : [
      {
        if {
          conditions : [
            { contains { logCollectionCategory : [packet] } }
          ]
          then : [
            {
              harnessCmd  {
                morphlineFile : "dpi-http.conf"
                morphlineId : "dpi-http"
                fullCopy : true
              }
            },
            {
              validateSupportedFormat  {
                failOnUnknownFields : "false"
                defaultFormat : "WebProxyMef"
              }
            }
          ]
          else : [
              {
                scriptSelector {
                  scripts : [
                    {
                        logicalName : "epilog",
                        morphlineFile : "epilog-to-mef.conf",
                        morphlineId : "epilog"
                        transferFieldNamedToMessage : "syslogMessage"
                    }, 
                    {
                        logicalName : "cisco",
                        morphlineFile : "ciscopix-to-mef.conf",
                        morphlineId : "asapixfwsm"
                        transferFieldNamedToMessage : "syslogMessage"
                    }, 
                    {
                        logicalName : "syslog",
                        morphlineFile : "logcollection-syslog.conf",
                        morphlineId : "sysloglogcollection",
                    }, 
                    {
                        logicalName : "syslogalt",
                        morphlineFile : "logcollection-syslog.conf",
                        morphlineId : "sysloglogcollectionalt",
                    }, 
                    {
                        logicalName : "sshd",
                        morphlineFile : "ssh-to-mef.conf",
                        morphlineId : "sshd",
                        transferFieldNamedToMessage : "syslogMessage"
                    }, 
                    {
                        logicalName : "bluecoatraw",
                        morphlineFile : "logcollection-bluecoat.conf",
                        morphlineId : "bluecoatalt",
                        transferFieldNamedToMessage : "message"
                    }, 
                    {
                        logicalName : "bluecoat",
                        morphlineFile : "logcollection-bluecoat.conf",
                        morphlineId : "bluecoat",
                        transferFieldNamedToMessage : "message"
                    }, 
                    {
                        logicalName : "dummy",
                        morphlineFile : "simple_ruleset_collector.conf",
                        morphlineId : "simplerulesetcollector",
                        transferFieldNamedToMessage : "syslogMessage"
                    }, 
                    {
                        logicalName : "cef",
                        morphlineFile : "logcollection-cef.conf",
                        morphlineId : "cef",
                    }
                    {
                        logicalName : "cefmissinghost",
                        morphlineFile : "logcollection-cef.conf",
                        morphlineId : "ceffromsyslogmissinghost",
                    },
                    {
                        logicalName : "sonicos",
                        morphlineFile : "logcollection-sonicos.conf",
                        morphlineId : "sonicos",
                    },
                    {
                        logicalName : "fromrsquidprocess",
                        morphlineFile : "webproxy-squid.conf",
                        morphlineId : "fromrsquidprocess",
                    },
                    {
                        logicalName : "squiddefault",
                        morphlineFile : "webproxy-squid.conf",
                        morphlineId : "squiddefault",
                        transferFieldNamedToMessage : "squidMessage"
                    },
                    {
                        logicalName : "squidcombined",
                        morphlineFile : "webproxy-squid.conf",
                        morphlineId : "squidcombined",
                        transferFieldNamedToMessage : "squidMessage"
                    },
                    {
                        logicalName : "netflowv5",
                        morphlineFile : "logcollection-Netflowv5.conf",
                        morphlineId : "netflowv5",
                        transferFieldNamedToMessage : "message"
                    }

                  ]
                  ################################################################################
                  selectors : [
                    {
                      #Oct 16 10:49:20 ciscopix %PIX-6-302015: B
                      pattern : "\\S{3}\\s\\S{2}\\s[^:]{1,2}:[^:]{1,2}:[^:]{2}\\s"
                      logicalScriptName : ["syslog"] // optional
                      subPatterns : [
                        {
                          readFromFieldNamed  : "syslogMessage"
                          pattern : "^sshd"
                          logicalScriptName : ["sshd"]
                        }, 
                        {
                          readFromFieldNamed  : "syslogMessage"
                          pattern : "^%(?:PIX|ASA|FWSM)"
                          logicalScriptName : ["cisco"]
                        }, 
                        {
                          readFromFieldNamed  : "syslogMessage"
                          pattern : "^CEF:"
                          logicalScriptName : ["cef"]
                        }, 
        #                {
        #                  readFromFieldNamed  : "syslogMessage"
        #                  pattern : "."
        #                  logicalScriptName : ["epilog"]
        #                },
                        {
                          readFromFieldNamed  : "syslogMessage"
                          pattern : "^sudo"
                          logicalScriptName : ["dummy"]
                        } 
                      ]
                    },
                    {
                      #10/31/2013 23:59:12 10.2.1.1 %CP: time:31May2003  6:46:25;action:accept;orig:10.2.1.1;i/f_dir:0;i/f_name:1;src:209.46.4.217;s_port:68;dst:255.255.255.255;service:67;proto:17;rule:6;packets:1;bytes:339;
                      #10/31/2013 23:59:12  EDT: %ASA-session-6-302013: Built inbound TCP connection 130506667 for PPOC-External:172.30.60.77/1099 (172.30.60.77/1099) to PPOC-Internal:172.30.130.22/135 (172.30.130.22/135)
                      #10/31/2013 23:59:12 9 138.83.127.113 MSWinEventLog	0	Security	0	Fri Jul 20 14 4 25 2012 	4624	Microsoft-Windows-Security-Auditing	NULL SID	Well Known Group	Success Audit	TPAP1CUADCV01.vdsi.ent.verizon.com	Logon		An account was successfully logged on.    Subject:   Security ID:  S-1-0-0   Account Name:  -   Account Domain:  -   Logon ID:  0x0    Logon Type:   3    New Logon:   Security ID:  S-1-5-21-1757981266-413027322-725345543-42322   Account Name:  V034875   Account Domain:  VDSI   Logon ID:  0x418239b8   Logon GUID:  {E70AC93E-D363-8845-43D3-866F64C93332}    Process Information:   Process ID:  0x0   Process Name:  -    Network Information:   Workstation Name:    Source Network Address: 114.8.16.114   Source Port:  1965    Detailed Authentication Informat

                      pattern : "\\d{1,2}/\\d{1,2}/\\d+\\s[^:]{1,2}:[^:]{1,2}:[^:]{2}\\s"
                      logicalScriptName : [] // optional
                      subPatterns : [
                        {
                          readFromFieldNamed  : "message"
                          patternMatchingStyle : "greedy"
                          pattern : "^\\d+\\.\\d+\\.\\d+\\.\\d+:?\\s"
                          logicalScriptName : ["syslogalt"]
                          subPatterns : [
                            {
                              readFromFieldNamed  : "syslogMessage"
                              pattern : "^sudo"
                              logicalScriptName : ["dummy"]
                            } 

                          ]
                        }, 
                        {
                          readFromFieldNamed  : "message"
                          patternMatchingStyle : "greedy"
                          pattern : "^\\d+\\s\\d+\\.\\d+\\.\\d+\\.\\d+\\s\\d+"
                          logicalScriptName : ["bluecoatraw"] 
                          subPatterns : [
                          ]
                        }, 
                        {
                          readFromFieldNamed  : "message"
                          patternMatchingStyle : "greedy"
                          pattern : "CEF"
                          logicalScriptName : ["cefmissinghost"]
                        }, 
                        #{
                        #    readFromFieldNamed  : "syslogMessage"
                        #    pattern : "^CEF:"
                        #    logicalScriptName : ["cef"]
                        #}, 
                      ]
                    },
                    {
                      # collision with checkpoint expecting a number after date time (to prevent date time host patterns)
                      # 2014-03-04 15:18:17 18 211.243.91.128 400 TCP_NC_MISS 9302 1681 POST http 192.16.170.42 /_vti_bin/_vti_aut/fp30reg.dll - - NONE 192.16.170.42 - - DENIED none - 192.16.170.42 SG-HTTP-Service - - -	77629
                      pattern : "^#Fields:\\s|\\d{4}-\\d{2}-\\d{2}\\s\\d+"
                      logicalScriptName : ["bluecoat"] 
                      subPatterns : []
                    },
                    {
                      #id=firewall
                      pattern : "id=firewall\\s"
                      logicalScriptName : ["sonicos"] // optional
                      subPatterns : []
                    },
                    {
                      #[NetFlow: 9995]
                      pattern : "\\[NetFlow:\\s\\d+\\]\\s"
                      logicalScriptName : ["netflowv5"] // optional
                      subPatterns : []
                    },
                    {
                      pattern : "^\\(squid\\)"
                      logicalScriptName : ["fromrsquidprocess"] // optional
                      patternMatchingStyle : "greedy"
                      subPatterns : [
                        #(squid):   81.56.112.95 - - [28/Feb/2014:08:32:35 -0500] "GET http://www.squid-cache.org/Doc/config/logformat/ HTTP/1.1" 304 431 "http://wiki.squid-cache.org/Features/LogFormat" "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:27.0) Gecko/20100101 Firefox/27.0" TCP_REFRESH_UNMODIFIED:DIRECT
                        {
                          readFromFieldNamed  : "squidMessage"
                          pattern : "^\\d+\\.\\d+\\.\\d+\\.\\d+\\s"
                          logicalScriptName : ["squidcombined"] 
                          subPatterns : [
                          ]
                        },{
                        #(squid): 1392831663.466  242209 81.56.112.95 TCP_MISS/200 100541 CONNECT scontent-b.xx.fbcdn.net:443 - DIRECT/31.13.69.68 -
                          readFromFieldNamed  : "squidMessage"
                          pattern : "^\\d+\\.\\d+\\s"
                          logicalScriptName : ["squiddefault"] 
                          subPatterns : [
                          ]
                        }
                      ]
                    }
                  ]
                }# scriptSelector end
              }
          ]
        }
      }
    ]
  }
]
