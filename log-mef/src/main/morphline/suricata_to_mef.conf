morphlines : [
  {
    id : suricata
    importCommands : [ "org.kitesdk.morphline.**","com.securityx.model.mef.morphline.**"]
    commands : [
      {
        grok {

            dictionaryString : """
              ####################
              SEV <\d+>
              #DATE TIME
              # Months: January, Feb, 3, 03, 12, December
              MONTH \b(?:Jan(?:uary)?|Feb(?:ruary)?|Mar(?:ch)?|Apr(?:il)?|May|Jun(?:e)?|Jul(?:y)?|Aug(?:ust)?|Sep(?:tember)?|Oct(?:ober)?|Nov(?:ember)?|Dec(?:ember)?)\b
              MONTHNUM (?:0?[1-9]|1[0-2])
              MONTHDAY (?:(?:0[1-9])|(?:[12][0-9])|(?:3[01])|[1-9])
              # Years?
              YEAR (?>\d\d){1,2}
              # Time: HH:MM:SS
              HOUR (?:2[0123]|[01]?[0-9])
              MINUTE (?:[0-5][0-9])
              # '60' is a leap second in most time standards and thus is valid.
              SECOND (?:(?:[0-5][0-9]|60)(?:[:.,][0-9]+)?)
              MICROSECOND (\d{6})
              TIME (?!<[0-9])%{HOUR}:%{MINUTE}(?::%{SECOND})(?![0-9])


              # 02/26/2015-19:12:23.858548
              SURDATE %{MONTHNUM}/%{MONTHDAY}/%{YEAR}-%{TIME}.%{MICROSECOND}
              
              ####################
              # Hostname and IP
              IPV4 (?<![0-9])(?:(?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})[.](?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})[.](?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})[.](?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2}))(?![0-9])
              # IPV6 
              ##################
              # GENERIC
              DATAGREEDY .*
              SID \d+
              REV \d*
              PRIORITY \d
              PROTO TCP|UDP|HTTP|FTP|\w+
              CLASS \(null\)|\.+
              MSG .+
            """
            
            # Suricata Fast Log Line :
            # 02/26/2015-19:12:23.858548  [**] [1:10808080:1] ZeuS RAT default URI [**] [Classification: (null)] [Priority: 3] {TCP} 192.168.1.94:1051 -> 64.50.186.17:80
            expressions : {
                suricataLine : """%{SURDATE:startDate}\s+\[\*\*\]\s\[\d+:%{SID:sigID}:%{REV:sigRev}\]\s%{MSG:sigMessage}\s\[\*\*\]\s\[Classification:\s%{CLASS:sigClass}\]\s\[Priority:\s%{PRIORITY:sigPriority}\]\s\{%{PROTO:protocol}\}\s%{DATAGREEDY:peers}"""
            }
            extract : true
            findSubstrings : false
            addEmptyStrings : false
        }
      },
      {
        ruleset {
            name : "Suricata-fast",
            field : "peers",
            sampleUnmatchedTo : "./target/fast-unmatched.log",
            nodes : [
                {
                    dictionaryString : """
                        # Hostname and IP
                        IPV4 (?<![0-9])(?:(?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})[.](?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})[.](?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})[.](?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2}))(?![0-9])
                        # IPV6
                        # IP (?:%{IPV4}|%{IPV6})
                        PORT (\d{1,5})
                    """
                    expr : """%{IPV4:sourceIP}:%{PORT:sourcePort}\s->\s%{IPV4:destIP}:%{PORT:destPort}"""
                    children : []
                },{
                    dictionaryString : """
                        # Hostname and IP
                        IPV4 (?<![0-9])(?:(?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})[.](?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})[.](?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})[.](?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2}))(?![0-9])
                        # IPV6
                        # IP (?:%{IPV4}|%{IPV6})
                        PORT (\d{1,5})
                    """
                    expr : """%{IPV4:destIP}:%{PORT:destPort}\s<-\s%{IPV4:sourceIP}:%{PORT:sourcePort}"""
                    children : []
                },{
                    dictionaryString : """
                        # Hostname and IP
                        IPV4 (?<![0-9])(?:(?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})[.](?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})[.](?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})[.](?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2}))(?![0-9])
                        # IPV6
                        # IP (?:%{IPV4}|%{IPV6})
                        PORT (\d{1,5})
                    """
                    expr : """%{IPV4:sourceIP}:%{PORT:sourcePort}\s<>\s%{IPV4:destIP}:%{PORT:destPort}"""
                    children : []
                }
            ]
        }
      }

    ]
  }
]
