include classpath("logparsingjob.conf")
morphlines : [
  {
    # Name used to identify a morphline. E.g. used if there are multiple
    # morphlines in a morphline config file
    id : windowssnare

    # Import all morphline commands in these java packages and their subpackages.
    # Other commands that may be present on the classpath are not visible to this
    # morphline.
    importCommands : [ "org.kitesdk.morphline.**", "com.securityx.model.mef.morphline.**"]


    #SAMPLE LOG : windows snare
    #MSWinEventLog	0	Security	9676	Thu Apr 24 12:43:48 2014	4672	Microsoft-Windows-Security-Auditing    E8SEC\W2K8R2-AD$	N/A	Success Audit	w2k8r2-AD.e8sec.lab	Special Logon		Special privileges assigned to new logon.    Subject:   Security ID:  S-1-5-18   Account Name:  W2K8R2-AD$   Account Domain:  E8SEC   Logon ID:  0x285d611    Privileges:  SeSecurityPrivilege     SeBackupPrivilege     SeRestorePrivilege     SeTakeOwnershipPrivilege     SeDebugPrivilege     SeSystemEnvironmentPrivilege     SeLoadDriverPrivilege     SeImpersonatePrivilege     SeEnableDelegationPrivilege	9675 

    commands : [

      {
        grok {
          #
          dictionaryString : """
            MSWINEVENTLOGHEADER MSWinEventLog
            CRITICALITY \d+
            SOURCENAME [^\t]+
            SNAREEVENTCOUNTER \d+
            EVENTDATE [^\t]+
            EVENTID [^\t]+
            EVENTLOGNAME [^\t]+
            EVENTUSER [^\t]+
            SIDTYPE [^\t]+
            EVENTLOGTYPE [^\t]+
            COMPUTERNAME [^\t]+
            CATEGORYSTRING [^\t]+
            SNAREMESSAGE .*
        """ 
        #
          expressions : {
              snareInput : """%{MSWINEVENTLOGHEADER:msWinEventLogHeader}\t%{CRITICALITY:snareCriticality}\t%{SOURCENAME:snareSourceName}\t%{SNAREEVENTCOUNTER:snareEventCounter}[\s\t]+%{EVENTDATE:startTime}\t%{EVENTID:snareEventId}\t%{EVENTLOGNAME:snareEventLogName}\t(?:%{EVENTUSER:snareEventUser})?\t%{SIDTYPE:snareSIDType}\t%{EVENTLOGTYPE:eventLogType}\t%{COMPUTERNAME:snareComputerName}\t%{CATEGORYSTRING:snareCategoryString}\t{1,2}%{SNAREMESSAGE:snareMessageRaw}"""
          }
          extract : true
          findSubstrings : false
          addEmptyStrings : false 
        }

      },
      {
        grok {
          #
          dictionaryString : """
            SNAREMESSAGE [^\t]+
            CRC -?\w+
        """ 
        #
          expressions : {
              snareMessageRaw : """%{SNAREMESSAGE:snareMessage}(?:\t%{CRC:snareCrc}\s*)*"""
          }
          extract : true
          findSubstrings : false
          addEmptyStrings : false 
        }
      },
      {
        ruleset {
          name : "SnareSecurity",
          field : "snareMessage",
          sampleUnmatchedTo : "./target/windows-unmatched.log",
          nodes : [
            {
              # Security 4672
              # Special privileges assigned to new logon.    Subject:   Security ID:  S-1-5-18   Account Name:  W2K8R2-AD$   Account Domain:  E8SEC   Logon ID:  0x285d611    Privileges:  SeSecurityPrivilege     SeBackupPrivilege     SeRestorePrivilege     SeTakeOwnershipPrivilege     SeDebugPrivilege     SeSystemEnvironmentPrivilege     SeLoadDriverPrivilege     SeImpersonatePrivilege     SeEnableDelegationPrivilege
              dictionaryString : """
                SNAREMSGDESC Special privileges assigned to new logon\.
                SECURITYID \S+
                ACCOUNTNAME .{1,64}\S
                DOMAIN .*?\S+
                LOGINID \S+
                PRIVILEGES .*
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject:\s+Security\sID:\s+%{SECURITYID:destinationSecurityID}\s+Account\sName:\s+%{ACCOUNTNAME:destinationUserName}\s+Account\sDomain:\s+%{DOMAIN:destinationNtDomain}\s+Logon\sID:\s+%{LOGINID:targetLoginID}\s+Privileges:\s+%{PRIVILEGES:privileges}"""
              children : []
            },
            {
              #Security 4768
              #A Kerberos authentication ticket (TGT) was requested.    Account Information:   Account Name:  jyria   Supplied Realm Name: e8sec.lab   User ID:   S-1-5-21-1908711140-209524994-2501478566-1104    Service Information:   Service Name:  krbtgt   Service ID:  S-1-5-21-1908711140-209524994-2501478566-502    Network Information:   Client Address:  ::ffff:192.168.12.21   Client Port:  58741    Additional Information:   Ticket Options:  0x40810010   Result Code:  0x0   Ticket Encryption Type: 0x12   Pre-Authentication Type: 2    Certificate Information:   Certificate Issuer Name:     Certificate Serial Number:    Certificate Thumbprint:      Certificate information is only provided if a certificate was used for pre-authentication.    Pre-authentication types, ticket options, encryption types and result codes are defined in RFC 4120.	10903
              dictionaryString : """
                SNAREMSGDESC A Kerberos authentication ticket \(TGT\) was requested\.
                ACCOUNTNAME .{1,64}\S
                SUPPLIEDREALMNAME \S+
                USERID \S+
                SERVICENAME .*?\S
                SERVICEID \S+
                CLIENTADDRESS \S+
                CLIENTPORT \S+
                TICKETOPTIONS \S+
                RESULTCODE \S+
                TICKETENCRYPTIONTYPE \S+
                PREAUTHENTICATIONTYPE \S+
                CERTIFICATEISSUER \S+
                CERTIFICATESERIALNUMBER \S+
                CERTIFICATETHUMBPRINT \S+

              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Account\sInformation:\s+Account\sName:\s+%{ACCOUNTNAME:destinationUserName}\s+Supplied\sRealm\sName:\s+%{SUPPLIEDREALMNAME:destinationNtDomain}\s+User\sID:\s+%{USERID:destinationSecurityID}\s+Service\sInformation:\s+Service\sName:\s+%{SERVICENAME:destinationServiceName}\s+Service\sID:\s+%{SERVICEID:destinationServiceSecurityID}\s+Network\sInformation:\s+Client\sAddress:\s+%{CLIENTADDRESS:sourceNameOrIp}\s+Client\sPort:\s+%{CLIENTPORT:sourcePort}\s+Additional\sInformation:\s+Ticket\sOptions:\s+%{TICKETOPTIONS:ticketOptions}\s+Result\sCode:\s+%{RESULTCODE:status}\s+Ticket\sEncryption\sType:\s+%{TICKETENCRYPTIONTYPE:ticketEncryptionType}\s+Pre-Authentication\sType:\s+%{PREAUTHENTICATIONTYPE:preAuthenticationType}\s+Certificate\sInformation:\s+Certificate\sIssuer\sName:\s+(?:%{CERTIFICATEISSUER:certificateIssuer}\s+)?Certificate\sSerial\sNumber:\s+(?:%{CERTIFICATESERIALNUMBER:certificateSerialNumber}\s+)?Certificate\sThumbprint:\s+(?:%{CERTIFICATETHUMBPRINT:certificateThumbPrint}\s+)?Certificate\sinformation.*"""
              children : []
            },
            {
              #Security 4771
              #Kerberos pre-authentication failed.    Account Information:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1104   Account Name:  jyria    Service Information:   Service Name:  krbtgt/e8sec.lab    Network Information:   Client Address:  ::1   Client Port:  0    Additional Information:   Ticket Options:  0x40810010   Failure Code:  0x18   Pre-Authentication Type: 2    Certificate Information:   Certificate Issuer Name:     Certificate Serial Number:     Certificate Thumbprint:      Certificate information is only provided if a certificate was used for pre-authentication.    Pre-authentication types, ticket options and failure codes are defined in RFC 4120.    If the ticket was malformed or damaged during transit and could not be decrypted, then many fields in this event might not be present.	10743
              dictionaryString : """
                SNAREMSGDESC Kerberos pre-authentication failed\.
                SECURITYID \S+
                ACCOUNTNAME .{1,64}\S
                SERVICENAME .*?\S
                CLIENTADDRESS \S+
                CLIENTPORT \S+
                TICKETOPTIONS \S+
                FAILURECODE \S+
                PREAUTHENTICATIONTYPE \S+
                CERTIFICATEISSUER \S+
                CERTIFICATESERIALNUMBER \S+
                CERTIFICATETHUMBPRINT \S+
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Account\sInformation:\s+Security\sID:\s+%{SECURITYID:destinationSecurityID}\s+Account\sName:\s+%{ACCOUNTNAME:destinationUserName}\s+Service\sInformation:\s+Service\sName:\s+%{SERVICENAME:destinationServiceName}\s+Network\sInformation:\s+Client\sAddress:\s+%{CLIENTADDRESS:sourceNameOrIp}\s+Client\sPort:\s+%{CLIENTPORT:sourcePort}\s+Additional\sInformation:\s+Ticket\sOptions:\s+%{TICKETOPTIONS:ticketOptions}\s+Failure\sCode:\s+%{FAILURECODE:status}\s+Pre-Authentication\sType:\s+%{PREAUTHENTICATIONTYPE:preAuthenticationType}\s+Certificate\sInformation:\s+Certificate\sIssuer\sName:\s+(?:%{CERTIFICATEISSUER:certificateIssuer}\s+)?Certificate\sSerial\sNumber:\s+(?:%{CERTIFICATESERIALNUMBER:certificateSerialNumber}\s+)?Certificate\sThumbprint:\s+(?:%{CERTIFICATETHUMBPRINT:certificateThumbPrint})?Certificate\sinformation.*"""
              children : []
            },
            {
              #Security 4769
              #A Kerberos service ticket was requested.    Account Information:   Account Name:  jyria@E8SEC.LAB   Account Domain:  E8SEC.LAB   Logon GUID:  {AD7B3FA1-ABFF-23FE-F052-73002A41531D}    Service Information:   Service Name:  W2K8R2-SRC$   Service ID:  S-1-5-21-1908711140-209524994-2501478566-1106    Network Information:   Client Address:  ::ffff:192.168.12.21   Client Port:  58742    Additional Information:   Ticket Options:  0x40810000   Ticket Encryption Type: 0x12   Failure Code:  0x0   Transited Services: -    This event is generated every time access is requested to a resource such as a computer or a Windows service.  The service name indicates the resource to which access was requested.    This event can be correlated with Windows logon events by comparing the Logon GUID fields in each event.  The logon event occurs on the machine that was accessed, which is often a different machine than the domain controller which issued the service ticket.    Ticket options, encryption types, and failure codes are defined in RFC 4120.	4767
              dictionaryString : """
                SNAREMSGDESC A Kerberos service ticket was requested\.
                ACCOUNTNAME .{1,64}\S
                ACCOUNTDOMAIN .*?\S+
                LOGONGUID \S+
                SERVICENAME .*?\S
                SERVICEID \S+
                CLIENTADDRESS \S+
                CLIENTPORT \S+
                TICKETOPTIONS \S+
                TICKETENCRYPTIONTYPE \S+
                FAILURECODE \S+
                TRANSITEDSERVICE \S+
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Account\sInformation:\s+Account\sName:\s+(?:%{ACCOUNTNAME:destinationUserName})?\s+Account\sDomain:\s+(?:%{ACCOUNTDOMAIN:destinationNtDomain})?\s+Logon\sGUID:\s+%{LOGONGUID:destinationLogonGUID}\s+Service\sInformation:\s+Service\sName:\s+(?:%{SERVICENAME:destinationServiceName})?\s+Service\sID:\s+%{SERVICEID:destinationServiceSecurityID}\s+Network\sInformation:\s+Client\sAddress:\s+%{CLIENTADDRESS:sourceNameOrIp}\s+Client\sPort:\s+%{CLIENTPORT:sourcePort}\s+Additional\sInformation:\s+Ticket\sOptions:\s+%{TICKETOPTIONS:ticketOptions}\s+Ticket\sEncryption\sType:\s+%{TICKETENCRYPTIONTYPE:ticketEncryptionType}\s+Failure\sCode:\s+%{FAILURECODE:status}\s+Transited Services:\s+%{TRANSITEDSERVICE:transitedService}\s+This\sevent\sis.*"""
              children : []
            },
            {
              #Security 4672
              #Special privileges assigned to new logon.    Subject:   Security ID:  S-1-5-18   Account Name:  W2K8R2-AD$   Account Domain:  E8SEC   Logon ID:  0x9d9ae1    Privileges:  SeSecurityPrivilege     SeBackupPrivilege     SeRestorePrivilege     SeTakeOwnershipPrivilege     SeDebugPrivilege     SeSystemEnvironmentPrivilege     SeLoadDriverPrivilege     SeImpersonatePrivilege     SeEnableDelegationPrivilege	10896
              dictionaryString : """
                SNAREMSGDESC Special privileges assigned to new logon\.
                SECURITYID \S+
                ACCOUNTNAME .{1,64}\S
                ACCOUNTDOMAIN .*?\S+
                LOGONID \S+
                PRIVILEGES .*
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject:\s+Security\sID:\s+%{SECURITYID:destinationSecurityID}\s+Account\sName:\s+%{ACCOUNTNAME:destinationUserName}\s+Account\sDomain:\s+%{ACCOUNTDOMAIN:destinationNtDomain}\s+Logon\sID:\s+%{LOGONID:destinationLogonID}\s+Privileges:\s+%{PRIVILEGES:privileges}"""
              children : []
            },
            {
              #Security 4776
              #The computer attempted to validate the credentials for an account.    Authentication Package: MICROSOFT_AUTHENTICATION_PACKAGE_V1_0  Logon Account: jyria  Source Workstation: W2K8R2LAB  Error Code: 0x0	10901
              dictionaryString : """
                SNAREMSGDESC The computer attempted to validate the credentials for an account\.
                AUTHENTICATIONPACKAGE \S+
                LOGONACCOUNT \S+
                SOURCEWORKSTATION \S+
                ERRORCODE \S+
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Authentication\sPackage:\s+%{AUTHENTICATIONPACKAGE:authenticationPackage}\s+Logon\sAccount:\s+(?:%{LOGONACCOUNT:destinationUserName})?\s+Source\sWorkstation:\s+(?:%{SOURCEWORKSTATION:sourceNameOrIp})?\s+Error\sCode:\s+%{ERRORCODE:status}"""
              children : []
            },
            {
              #Security 4634
              #An account was logged off.    Subject:   Security ID:  S-1-5-18   Account Name:  W2K8R2-AD$   Account Domain:  E8SEC   Logon ID:  0x9ddae3    Logon Type:   3    This event is generated when a logon session is destroyed. It may be positively correlated with a logon event using the Logon ID value. Logon IDs are only unique between reboots on the same computer.	10928
              dictionaryString : """
                SNAREMSGDESC An account was logged off\.
                SECURITYID \S+
                ACCOUNTNAME .{1,64}\S
                ACCOUNTDOMAIN .*?\S
                LOGONID \S+
                LOGONTYPE \S+
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject:\s+Security\sID:\s+%{SECURITYID:destinationSecurityID}\s+Account\sName:\s+%{ACCOUNTNAME:destinationUserName}\s+Account\sDomain:\s+%{ACCOUNTDOMAIN:destinationNtDomain}\s+Logon\sID:\s+%{LOGONID:destinationLogonID}\s+Logon\sType:\s+%{LOGONTYPE:destinationLogonType}\s+This\sevent\sis.*"""
              children : []
            },
            {
              #Security 4647
              #User initiated logoff:    Subject:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1104   Account Name:  jyria   Account Domain:  E8SEC   Logon ID:  0x2b20e0e    This event is generated when a logoff is initiated. No further user-initiated activity can occur. This event can be interpreted as a logoff event.	10809
              dictionaryString : """
                SNAREMSGDESC User initiated logoff
                SECURITYID \S+
                ACCOUNTNAME .{1,64}\S
                ACCOUNTDOMAIN .*?\S+
                LOGONID \S+
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}:\s+Subject:\s+Security\sID:\s+%{SECURITYID:destinationSecurityID}\s+Account\sName:\s+%{ACCOUNTNAME:destinationUserName}\s+Account\sDomain:\s+%{ACCOUNTDOMAIN:destinationNtDomain}\s+Logon\sID:\s+%{LOGONID:destinationLogonID}\s+This\sevent\sis.*"""
              children : []
            },
            {
              #Security 4648
              #A logon was attempted using explicit credentials.    Subject:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-500   Account Name:  Administrator   Account Domain:  E8SEC   Logon ID:  0x9b4e1f   Logon GUID:  {95B1BAFF-60FC-A163-133B-5386CB2C54F5}    Account Whose Credentials Were Used:   Account Name:  jyria   Account Domain:  E8SEC   Logon GUID:  {00000000-0000-0000-0000-000000000000}    Target Server:   Target Server Name: w2k8r2-AD.e8sec.lab   Additional Information: w2k8r2-AD.e8sec.lab    Process Information:   Process ID:  0x1e8   Process Name:  C:\Windows\System32\lsass.exe    Network Information:   Network Address: -   Port:   -    This event is generated when a process attempts to log on an account by explicitly specifying that accountӳ credentials.  This most commonly occurs in batch-type configurations such as scheduled tasks, or when using the RUNAS command.	10585
              dictionaryString : """
                SNAREMSGDESC A logon was attempted using explicit credentials\.
                SRCSECURITYID \S+
                SRCACCOUNTNAME .{1,64}\S
                SRCACCOUNTDOMAIN .*?\S+
                SRCLOGONID \S+
                SRCLOGONGUID \S+
                DSTACCOUNTNAME .{1,64}\S
                DSTACCOUNTDOMAIN .*?\S+
                DSTLOGONGUID \S+
                TARGETSERVERNAME \S+
                PROCESSID \S+
                PROCESSNAME .*?\S
                NETWORKADDRESS \S+
                PORT \S+
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject:\s+Security\sID:\s+%{SRCSECURITYID:sourceSecurityID}\s+Account\sName:\s+%{SRCACCOUNTNAME:sourceUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:sourceNtDomain}\s+Logon\sID:\s+%{SRCLOGONID:sourceLogonID}\s+Logon\sGUID:\s+%{SRCLOGONGUID:sourceLogonGUID}\s+Account\sWhose\sCredentials\sWere\sUsed:\s+Account\sName:\s+%{DSTACCOUNTNAME:destinationUserName}\s+Account\sDomain:\s+%{DSTACCOUNTDOMAIN:destinationNtDomain}\s+Logon\sGUID:\s+%{DSTLOGONGUID:destinationLogonGUID}\s+Target\sServer:\s+Target\sServer\sName:\s+%{TARGETSERVERNAME:destinationNameOrIp}\s+Additional\sInformation:\s+\S+\s+Process\sInformation:\s+Process\sID:\s+%{PROCESSID:sourceProcessId}\s+Process\sName:\s+(?:%{PROCESSNAME:sourceProcessName})?\s+Network\sInformation:\s+Network\sAddress:\s+(?:-|%{NETWORKADDRESS:sourceNameOrIp})\s+Port:\s+(?:-|%{PORT:sourcePort})\s+This\sevent\sis.*"""
              children : []
            },
            {
              #Security 4742
              #A computer account was changed.    Subject:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1104   Account Name:  jyria   Account Domain:  E8SEC   Logon ID:  0x2ee7a7b    Computer Account That Was Changed:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1116   Account Name:  WINDHCPCLIENT$   Account Domain:  E8SEC    Changed Attributes:   SAM Account Name: -   Display Name:  -   User Principal Name: -   Home Directory:  -   Home Drive:  -   Script Path:  -   Profile Path:  -   User Workstations: -   Password Last Set: 4/25/2014 8:01:38 AM   Account Expires:  -   Primary Group ID: -   AllowedToDelegateTo: -   Old UAC Value:  -   New UAC Value:  -   User Account Control: -   User Parameters: -   SID History:  -   Logon Hours:  -   DNS Host Name:  -   Service Principal Names: -    Additional Information:   Privileges:  -	7956
                            dictionaryString : """
                SNAREMSGDESC A computer account was changed\.
                SRCSECURITYID \S+
                SRCACCOUNTNAME .{1,64}\S
                SRCACCOUNTDOMAIN .*?\S+
                SRCLOGONID \S+
                SRCLOGONGUID \S+
                DSTSECURITYID \S+
                DSTACCOUNTNAME .{1,64}\S
                DSTACCOUNTDOMAIN .*?\S+
                SAMACCOUNTNAME .{1,64}\S
                DISPLAYNAME \S+
                USERPRINCIPALENAME \S+
                HOMEDIRECTORY \S+
                HOMEDRIVE \S+
                SCRIPTPATH \S+
                PROFILEPATH \S+
                USERWORKSTATION \S+
                PASSWDLASTSET .*?
                ACCOUNTEXPIRES .*?
                PRIMARYGROUPID \S+
                ALLOWEDTODELEGATETO \S+
                OLDUACVALUE \S+
                NEWUACVALUE \S+
                USERACCOUNTCONTROL \S+
                USERPARAMETERS \S+
                SIDHISTORY \S+
                LOGONHOURS \S+
                DNSHOSTNAME \S+
                SERVERPRINCIPALNAMES .*?\S
                PRIVILEGES .*
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject:\s+Security\sID:\s+%{SRCSECURITYID:sourceSecurityID}\s+Account\sName:\s+%{SRCACCOUNTNAME:sourceUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:sourceNtDomain}\s+Logon\sID:\s+%{SRCLOGONID:sourceLogonID}\s+Computer\sAccount\sThat\sWas\sChanged:\s+Security\sID:\s+%{DSTSECURITYID:destinationSecurityID}\s+Account\sName:\s+%{DSTACCOUNTNAME:destinationUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:destinationNtDomain}\s+Changed\sAttributes:\s+SAM\sAccount\sName:\s(?:-|%{SAMACCOUNTNAME:adSamAccountName})\s+Display\sName:\s+(?:-|%{DISPLAYNAME:adDisplayName})\s+User\sPrincipal\sName:\s+%{USERPRINCIPALENAME:adUserPrincipalName}\s+Home\sDirectory:\s+(?:-|%{HOMEDIRECTORY:adHomeDirectory}\s+)Home\sDrive:\s+(?:-|%{HOMEDRIVE:adHomeDrive}\s+)Script\sPath:\s+(?:-|%{SCRIPTPATH:adScriptPath}\s+)Profile\sPath:\s+(?:-|%{PROFILEPATH:adProfilePath}\s+)User\sWorkstations:\s+(?:-|%{USERWORKSTATION:adUserWorkstation}\s+)Password\sLast\sSet:\s+%{PASSWDLASTSET:adPasswdLastSet}\s+Account\sExpires:\s+(?:-|%{ACCOUNTEXPIRES:accountExpires}\s+)Primary\sGroup\sID:\s+(?:-|%{PRIMARYGROUPID:adPrimaryGroupID}\s+)AllowedToDelegateTo:\s+(?:-|%{ALLOWEDTODELEGATETO:allowedToDelegateTo}\s+)Old\sUAC\sValue:\s+(?:-|%{OLDUACVALUE:adOldUacValue}\s+)New\sUAC\sValue:\s+(?:-|%{NEWUACVALUE:newUacValue}\s+)User\sAccount\sControl:\s+(?:-|%{USERACCOUNTCONTROL:adUserAccountControl}\s+)User\sParameters:\s+(?:-|%{USERPARAMETERS:adUserParameters}\s+)SID\sHistory:\s+(?:-|%{SIDHISTORY:adSidHistory}\s+)Logon\sHours:\s+(?:-|%{LOGONHOURS:logonHours}\s+)DNS\sHost\sName:\s+(?:-|%{DNSHOSTNAME:adDnsHostName}\s+)Service\sPrincipal\sNames:\s+(?:-|%{SERVERPRINCIPALNAMES:adServerPrincipalNames}\s+)Additional\sInformation:\s+Privileges:\s+(?:-|%{PRIVILEGES:privileges})"""
              children : []
            },
            {
              #Security 4738
              #A user account was changed.    Subject:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-500   Account Name:  Administrator   Account Domain:  E8SEC   Logon ID:  0x9b4e1f    Target Account:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1118   Account Name:  officehours   Account Domain:  E8SEC    Changed Attributes:   SAM Account Name: -   Display Name:  -   User Principal Name: -   Home Directory:  -   Home Drive:  -   Script Path:  -   Profile Path:  -   User Workstations: -   Password Last Set: 4/28/2014 2:32:51 PM   Account Expires:  -   Primary Group ID: -   AllowedToDelegateTo: -   Old UAC Value:  -   New UAC Value:  -   User Account Control: -   User Parameters: -   SID History:  -   Logon Hours:  -    Additional Information:   Privileges:  -	1084
              dictionaryString : """
                SNAREMSGDESC A user account was changed\.
                SRCSECURITYID \S+
                SRCACCOUNTNAME .*?\S
                SRCACCOUNTDOMAIN .*?\S+
                SRCLOGONID \S+
                DSTSECURITYID \S+
                DSTACCOUNTNAME .*?\S
                DSTACCOUNTDOMAIN .*?\S
                SAMACCOUNTNAME \S{1,64}\S
                DISPLAYNAME \S+
                USERPRINCIPALENAME \S+
                HOMEDIRECTORY \S+
                HOMEDRIVE \S+
                SCRIPTPATH \S+
                PROFILEPATH \S+
                USERWORKSTATION \S+
                PASSWDLASTSET .*?
                ACCOUNTEXPIRES .*?
                PRIMARYGROUPID \S+
                ALLOWEDTODELEGATETO \S+
                OLDUACVALUE \S+
                NEWUACVALUE \S+
                USERACCOUNTCONTROL \S+
                USERPARAMETERS \S+
                SIDHISTORY \S+
                LOGONHOURS \S+
                DNSHOSTNAME \S+
                SERVERPRINCIPALNAMES .*?\S
                PRIVILEGES .*
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject:\s+Security\sID:\s+%{SRCSECURITYID:sourceSecurityID}\s+Account\sName:\s+%{SRCACCOUNTNAME:sourceUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:sourceNtDomain}\s+Logon\sID:\s+%{SRCLOGONID:sourceLogonID}\s+Target\sAccount:\s+Security\sID:\s+%{DSTSECURITYID:destinationSecurityID}\s+Account\sName:\s+%{DSTACCOUNTNAME:destinationUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:destinationNtDomain}\s+Changed\sAttributes:\s+SAM\sAccount\sName:\s(?:-|%{SAMACCOUNTNAME:adSamAccountName})\s+Display\sName:\s+%{DISPLAYNAME:adDisplayName}\s+User\sPrincipal\sName:\s+%{USERPRINCIPALENAME:adUserPrincipalName}\s+Home\sDirectory:\s+(?:-|%{HOMEDIRECTORY:adHomeDirectory}\s+)Home\sDrive:\s+(?:-|%{HOMEDRIVE:adHomeDrive}\s+)Script\sPath:\s+(?:-|%{SCRIPTPATH:adScriptPath}\s+)Profile\sPath:\s+(?:-|%{PROFILEPATH:adProfilePath}\s+)User\sWorkstations:\s+(?:-|%{USERWORKSTATION:adUserWorkstation}\s+)Password\sLast\sSet:\s+%{PASSWDLASTSET:adPasswdLastSet}\s+Account\sExpires:\s+(?:-|%{ACCOUNTEXPIRES:accountExpires}\s+)Primary\sGroup\sID:\s+(?:-|%{PRIMARYGROUPID:adPrimaryGroupID}\s+)AllowedToDelegateTo:\s+(?:-|%{ALLOWEDTODELEGATETO:allowedToDelegateTo}\s+)Old\sUAC\sValue:\s+(?:-|%{OLDUACVALUE:adOldUacValue}\s+)New\sUAC\sValue:\s+(?:-|%{NEWUACVALUE:newUacValue}\s+)User\sAccount\sControl:\s+(?:-|%{USERACCOUNTCONTROL:adUserAccountControl}\s+)User\sParameters:\s+(?:-|%{USERPARAMETERS:adUserParameters}\s+)SID\sHistory:\s+(?:-|%{SIDHISTORY:adSidHistory}\s+)Logon\sHours:\s+(?:-|%{LOGONHOURS:logonHours}\s+)Additional\sInformation:\s+Privileges:\s+(?:-|%{PRIVILEGES:privileges})"""
              children : []
            },
            {
              #Security 4624
              #An account was successfully logged on.    Subject:   Security ID:  S-1-0-0   Account Name:  -   Account Domain:  -   Logon ID:  0x0    Logon Type:   3    New Logon:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1104   Account Name:  jyria   Account Domain:  E8SEC   Logon ID:  0x9db891   Logon GUID:  {256434D9-27A8-8DD4-DC5D-E6466FFA6773}    Process Information:   Process ID:  0x0   Process Name:  -    Network Information:   Workstation Name:    Source Network Address: 192.168.12.21   Source Port:  58743    Detailed Authentication Information:   Logon Process:  Kerberos   Authentication Package: Kerberos   Transited Services: -   Package Name (NTLM only): -   Key Length:  0    This event is generated when a logon session is created. It is generated on the computer that was accessed.    The subject fields indicate the account on the local system which requested the logon. This is most commonly a service such as the Server service, or a local process such as Winlogon.exe or Services.exe.    The logon type field indicates the kind of logon that occurred. The most common types are 2 (interactive) and 3 (network).    The New Logon fields indicate the account for whom the new logon was created, i.e. the account that was logged on.    The network fields indicate where a remote logon request originated. Workstation name is not always available and may be left blank in some cases.    The authentication information fields provide detailed information about this specific logon request.   - Logon GUID is a unique identifier that can be used to correlate this event with a KDC event.   - Transited services indicate which intermediate services have participated in this logon request.   - Package name indicates which sub-protocol was used among the NTLM protocols.   - Key length indicates the length of the generated session key. This will be 0 if no session key was requested.	10908
                            dictionaryString : """
                SNAREMSGDESC An account was successfully logged on\.
                SRCSECURITYID \S+
                SRCACCOUNTNAME .{1,64}\S
                SRCACCOUNTDOMAIN .*?\S+
                SRCLOGONID \S+
                SRCLOGONTYPE \S+
                DSTSECURITYID \S+
                DSTACCOUNTNAME .{1,64}\S
                DSTACCOUNTDOMAIN .*?\S
                DSTLOGONID \S+
                DSTLOGONGUID \S+
                PROCESSID \S+
                PROCESSNAME .*?\S
                WORKSTATIONNAME .*?\S
                SRCNETWORKADDRESS \S+
                SRCPORT \S+
                LOGONPROCESS \S+
                AUTHENTICATIONPACKAGE \S+
                TRANSITEDSERVICES \S+
                PACKAGENAME .*?\S
                KEYLENGHT \S+
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject:\s+Security\sID:\s+%{SRCSECURITYID:sourceSecurityID}\s+Account\sName:\s+(?:-|%{SRCACCOUNTNAME:sourceUserName})\s+Account\sDomain:\s+(?:-|%{SRCACCOUNTDOMAIN:sourceNtDomain})\s+Logon\sID:\s+%{SRCLOGONID:sourceLogonID}\s+Logon\sType:\s+%{SRCLOGONTYPE:sourceLogonType}\s+(?:Impersonation\sLevel:\s+\S+\s+)?New\sLogon:\s+Security\sID:\s+%{DSTSECURITYID:destinationSecurityID}\s+Account\sName:\s+%{DSTACCOUNTNAME:destinationUserName}\s+Account\sDomain:\s+%{DSTACCOUNTDOMAIN:destinationNtDomain}\s+Logon\sID:\s+%{DSTLOGONID:destinationLogonID}\s+Logon\sGUID:\s+%{DSTLOGONGUID:destinationLogonGUID}\s+Process\sInformation:\s+Process\sID:\s+%{PROCESSID:sourceProcessID}\s+Process\sName:\s+(?:%{PROCESSNAME:sourceProcessName}\s+)?Network\sInformation:\s+Workstation\sName:\s+(?:-|%{WORKSTATIONNAME:sourceNameOrIp}\s+)?Source\sNetwork\sAddress:\s+(?:-|%{SRCNETWORKADDRESS:sourceAddress})\s+Source\sPort:\s+(?:-|%{SRCPORT:sourcePort})\s+Detailed\sAuthentication\sInformation:\s+Logon\sProcess:\s+%{LOGONPROCESS:logonProcess}\s+Authentication\sPackage:\s+%{AUTHENTICATIONPACKAGE:authenticationPackage}\s+Transited\sServices:\s+%{TRANSITEDSERVICES:transitedService}\s+Package\sName\s\(NTLM\sonly\):\s+%{PACKAGENAME:packageName}\s+Key\sLength:\s+%{KEYLENGHT:keyLength}\s+This\sevent\sis.*"""
              children : []
            },
            {
              #Security 4625
              #An account failed to log on.    Subject:   Security ID:  S-1-0-0   Account Name:  -   Account Domain:  -   Logon ID:  0x0    Logon Type:   3    Account For Which Logon Failed:   Security ID:  S-1-0-0   Account Name:  jyria   Account Domain:  e8sec    Failure Information:   Failure Reason:  Unknown user name or bad password.   Status:   0xc000006d   Sub Status:  0xc000006a    Process Information:   Caller Process ID: 0x0   Caller Process Name: -    Network Information:   Workstation Name: W2K8R2LAB   Source Network Address: -   Source Port:  -    Detailed Authentication Information:   Logon Process:  NtLmSsp    Authentication Package: NTLM   Transited Services: -   Package Name (NTLM only): -   Key Length:  0    This event is generated when a logon request fails. It is generated on the computer where access was attempted.    The Subject fields indicate the account on the local system which requested the logon. This is most commonly a service such as the Server service, or a local process such as Winlogon.exe or Services.exe.    The Logon Type field indicates the kind of logon that was requested. The most common types are 2 (interactive) and 3 (network).    The Process Information fields indicate which account and process on the system requested the logon.    The Network Information fields indicate where a remote logon request originated. Workstation name is not always available and may be left blank in some cases.    The authentication information fields provide detailed information about this specific logon request.   - Transited services indicate which intermediate services have participated in this logon request.   - Package name indicates which sub-protocol was used among the NTLM protocols.   - Key length indicates the length of the generated session key. This will be 0 if no session key was requested.	10495
              dictionaryString : """
                SNAREMSGDESC An account failed to log on\.
                SRCSECURITYID \S+
                SRCACCOUNTNAME .{1,64}\S
                SRCACCOUNTDOMAIN .*?\S+
                SRCLOGONID \S+
                SRCLOGONTYPE \S+
                DSTSECURITYID \S+
                DSTACCOUNTNAME .{1,64}\S
                DSTACCOUNTDOMAIN .*?\S+
                FAILUREREASON .*?\S
                STATUS \S+
                SUBSTATUS \S+
                CALLERPROCESSID \S+
                CALLPROCESSNAME .*?
                WORKSTATIONNAME \S.*?\S
                SRCNETWORKADDRESS \S+
                SRCPORT \S+
                LOGONPROCESS \S+
                AUTHENTICATIONPACKAGE \S+
                TRANSITEDSERVICES \S+
                PACKAGENAME \S+
                KEYLENGHT \S+
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject:\s+Security\sID:\s+%{SRCSECURITYID:sourceSecurityID}\s+Account\sName:\s+(?:-|%{SRCACCOUNTNAME:sourceUserName})\s+Account\sDomain:\s+(?:-|%{SRCACCOUNTDOMAIN:sourceNtDomain})\s+Logon\sID:\s+%{SRCLOGONID:sourceLogonID}\s+Logon\sType:\s+%{SRCLOGONTYPE:sourceLogonType}\s+Account\sFor\sWhich\sLogon\sFailed:\s+Security\sID:\s+%{DSTSECURITYID:destinationSecurityID}\s+Account\sName:\s+%{DSTACCOUNTNAME:destinationUserName}\s+Account\sDomain:\s+%{DSTACCOUNTDOMAIN:destinationNtDomain}?\s+Failure\sInformation:\s+Failure\sReason:\s+%{FAILUREREASON}\s+Status:\s+%{STATUS:status}\s+Sub\sStatus:\s+%{SUBSTATUS:subStatus}\s+Process\sInformation:\s+Caller\sProcess\sID:\s+%{CALLERPROCESSID:sourceProcessID}\s+Caller\sProcess\sName:\s+%{CALLPROCESSNAME:sourceProcessName}\s+Network\sInformation:\s+Workstation\sName:\s+(?:%{WORKSTATIONNAME:sourceNameOrIp}\s+)?Source\sNetwork\sAddress:\s+(?:-|%{SRCNETWORKADDRESS:sourceAddress})\s+Source\sPort:\s+(?:-|%{SRCPORT:sourcePort})\s+Detailed\sAuthentication\sInformation:\s+Logon\sProcess:\s+%{LOGONPROCESS:logonProcess}\s+Authentication\sPackage:\s+%{AUTHENTICATIONPACKAGE:authenticationPackage}\s+Transited\sServices:\s+%{TRANSITEDSERVICES:transitedService}\s+Package\sName\s\(NTLM\sonly\):\s+%{PACKAGENAME:packageName}\s+Key\sLength:\s+%{KEYLENGHT:keyLength}\s+This\sevent\sis.*"""
              children : []
            },
            {
              #Security 4673
              #A privileged service was called.    Subject:   Security ID:  S-1-5-18   Account Name:  W2K8R2-AD$   Account Domain:  E8SEC   Logon ID:  0x3e7    Service:   Server: NT Local Security Authority / Authentication Service   Service Name: LsaRegisterLogonProcess()    Process:   Process ID: 0x1e8   Process Name: C:\Windows\System32\lsass.exe    Service Request Information:   Privileges:  SeTcbPrivilege	4991
              dictionaryString : """
                SNAREMSGDESC A privileged service was called\.
                SECURITYID \S+
                ACCOUNTNAME .{1,64}\S
                ACCOUNTDOMAIN .*?\S+
                LOGONID \S+
                SERVICE .*?\S
                SERVICENAME \S+(?:\(\))?
                PROCESSID \S+
                PROCESSNAME .*?\S
                PRIVILEGES .*
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject:\s+Security\sID:\s+%{SECURITYID:sourceSecurityID}\s+Account\sName:\s+%{ACCOUNTNAME:sourceUserName}\s+Account\sDomain:\s+%{ACCOUNTDOMAIN:sourceNtDomain}\s+Logon\sID:\s+%{LOGONID:sourceLogonID}\s+Service:\s+Server:\s+%{SERVICE:destinationServiceServer}\s+Service\sName:\s+%{SERVICENAME:destinationProcessName}\s+Process:\s+Process\sID:\s+%{PROCESSID:sourceProcessID}\s+Process\sName:\s+(?:-|%{PROCESSNAME:sourceProcessName})?\s+Service\sRequest\sInformation:\s+Privileges:\s+%{PRIVILEGES:privileges}"""
              children : []
            },
            {
              #Security 4674
              #An operation was attempted on a privileged object.    Subject:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1104   Account Name:  jyria   Account Domain:  E8SEC   Logon ID:  0x2ee7a7b    Object:   Object Server: Security   Object Type: File   Object Name: C:\Users\Public\Music\Sample Music   Object Handle: 0x160    Process Information:   Process ID: 0x764   Process Name: C:\Windows\System32\dllhost.exe    Requested Operation:   Desired Access: READ_CONTROL      WRITE_DAC      WRITE_OWNER      ACCESS_SYS_SEC         Privileges:  SeSecurityPrivilege     SeTakeOwnershipPrivilege	10213
              dictionaryString : """
                SNAREMSGDESC An operation was attempted on a privileged object\.
                SECURITYID \S+
                ACCOUNTNAME .{1,64}\S
                ACCOUNTDOMAIN .*?\S+
                LOGONID \S+
                OBJECTSERVER \S.*?\S+
                OBJECTTYPE \S+
                OBJECTNAME .*?\S
                OBJECTHANDLE \S+
                PROCESSID \S+
                PROCESSNAME .*?\S
                DESIREDACCESS .*?\S
                PRIVILEGES .*
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject:\s+Security\sID:\s+%{SECURITYID:sourceSecurityID}\s+Account\sName:\s+%{ACCOUNTNAME:sourceUserName}\s+Account\sDomain:\s+%{ACCOUNTDOMAIN:sourceNtDomain}\s+Logon\sID:\s+%{LOGONID:sourceLogonID}\s+Object\:\s+Object\sServer:\s+%{OBJECTSERVER:destinationObjectServer}\s+Object\sType:\s+%{OBJECTTYPE:destinationObjectType}\s+Object\sName:\s+%{OBJECTNAME:destinationObjectName}\s+Object\sHandle:\s+%{OBJECTHANDLE:destinationObjectHandle}\s+Process\sInformation:\s+Process\sID:\s+%{PROCESSID:sourceProcessID}\s+Process\sName:\s+%{PROCESSNAME:sourceProcessName}\s+Requested\sOperation:\s+Desired\sAccess:\s+%{DESIREDACCESS:desiredAccess}\s+Privileges:\s+%{PRIVILEGES:privileges}\s*"""
              children : []
            },
            {
              # Security 4723
              # MSWinEventLog	0	Security	0	Fri Jul 20 5 30 6 2012 	4723	Microsoft-Windows-Security-Auditing	Carl.Mundy	User	Success Audit	TPAP1CUADCV01.vdsi.ent.example.com	User Account Management		An attempt was made to change an account's password.    Subject:   Security ID:  S-1-5-21-1757981266-413027322-725345543-10177   Account Name:  Carl.Mundy   Account Domain:  VDSI   Logon ID:  0x3b4aa08f    Target Account:   Security ID:  S-1-5-21-1757981266-413027322-725345543-95563   Account Name:  Z515541   Account Domain:  VDSI    Additional Information:   Privileges  -	229492194
              dictionaryString : """
                SNAREMSGDESC An attempt was made to change an account's password\.
                SRCSECURITYID \S+
                SRCACCOUNTNAME .{1,64}\S
                SRCACCOUNTDOMAIN .*?\S+
                SRCLOGONID \S+
                DSTSECURITYID \S+
                DSTACCOUNTNAME .{1,64}\S
                DSTACCOUNTDOMAIN .*?\S+
                PRIVILEGES .*
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject:\s+Security\sID:\s+%{SRCSECURITYID:sourceSecurityID}\s+Account\sName:\s+%{SRCACCOUNTNAME:sourceUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:sourceNtDomain}\s+Logon\sID:\s+%{SRCLOGONID:sourceLogonID}\s+Target\sAccount:\s+Security\sID:\s+%{DSTSECURITYID:destinationSecurityID}\s+Account\sName:\s+%{DSTACCOUNTNAME:destinationUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:destinationNtDomain}\s+Additional\sInformation:\s+Privileges:?\s+(?:-|%{PRIVILEGES:privileges})"""
              children : []
            },
            {
              # Security 4724
              # MSWinEventLog	0	Security	0	Fri Jul 20 3 26 29 2012 	4724	Microsoft-Windows-Security-Auditing	svc-vista-wksadd	User	Success Audit	TPAP1CUADC105.us1.ent.example.com	User Account Management		An attempt was made to reset an account's password.    Subject:   Security ID:  S-1-5-21-1801674531-2049760794-725345543-476317   Account Name:  svc-vista-wksadd   Account Domain:  US1   Logon ID:  0x504edf73    Target Account:   Security ID:  S-1-5-21-1801674531-2049760794-725345543-1212289   Account Name:  TUSFL031DKVT01F$   Account Domain:  US1	1650262152
              dictionaryString : """
                SNAREMSGDESC An attempt was made to reset an account's password\.
                SRCSECURITYID \S+
                SRCACCOUNTNAME .{1,64}\S
                SRCACCOUNTDOMAIN .*?\S+
                SRCLOGONID \S+
                DSTSECURITYID \S+
                DSTACCOUNTNAME .{1,64}\S
                DSTACCOUNTDOMAIN .*?\S+
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject:\s+Security\sID:\s+%{SRCSECURITYID:sourceSecurityID}\s+Account\sName:\s+%{SRCACCOUNTNAME:sourceUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:sourceNtDomain}\s+Logon\sID:\s+%{SRCLOGONID:sourceLogonID}\s+Target\sAccount:\s+Security\sID:\s+%{DSTSECURITYID:destinationSecurityID}\s+Account\sName:\s+%{DSTACCOUNTNAME:destinationUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:destinationNtDomain}"""
              children : []
            },
            {
              # Security 4663
              # MSWinEventLog	0	Security	1279709	Wed Feb 17 15:21:07 2016	4663	Microsoft-Windows-Security-Auditing	E8SEC\jyria	N/A	Success Audit	w2k8r2-AD.e8sec.lab	File System		An attempt was made to access an object.    Subject:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1104   Account Name:  jyria   Account Domain:  E8SEC   Logon ID:  0xeff5adc    Object:   Object Server: Security   Object Type: File   Object Name: C:\Windows\servicing   Handle ID: 0xa48    Process Information:   Process ID: 0x394   Process Name: C:\Windows\explorer.exe    Access Request Information:   Accesses: READ_CONTROL         Access Mask: 0x20000	1279708
              dictionaryString : """
                SNAREMSGDESC An attempt was made to access an object\.
                SRCSECURITYID \S+
                SRCACCOUNTNAME .{1,64}\S
                SRCACCOUNTDOMAIN .*?\S+
                SRCLOGONID \S+
                OBJECTSERVER \S.*?\S
                OBJECTTYPE \S+
                OBJECTNAME \S.*?\S
                HANDLEID \S+
                PROCESSID \S+
                PROCESSSNAME \S.*?\S
                ACCESSES \S.*?\S
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject:\s+Security\sID:\s+%{SRCSECURITYID:sourceSecurityID}\s+Account\sName:\s+%{SRCACCOUNTNAME:sourceUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:sourceNtDomain}\s+Logon\sID:\s+%{SRCLOGONID:sourceLogonID}\s+Object:\s+Object\sServer:\s+%{OBJECTSERVER:destinationObjectServer}\s+Object\sType:\s+%{OBJECTTYPE:destinationObjectType}\s+Object\sName:\s+%{OBJECTNAME:destinationObjectName}\s+Handle\sID:\s+%{HANDLEID:destinationObjectHandle}\s+.*Process\sInformation:\s+Process\sID:\s+%{PROCESSID:sourceProcessID}\s+Process\sName:\s+%{PROCESSSNAME:sourceProcessName}\s+Access\sRequest\sInformation:\s+Accesses:\s+%{ACCESSES:desiredAccess}\s+Access\s"""
              children : []
            },
            {
              # Security 4656
              # Security 4661
              # MSWinEventLog	0	Security	0	Fri Jul 20 5 32 33 2012 	4661	Microsoft-Windows-Security-Auditing	ANONYMOUS LOGON	Well Known Group	Failure Audit	TPAP1CUADCE02.ent.example.com	SAM		A handle to an object was requested.    Subject :   Security ID:  S-1-5-7   Account Name:  ANONYMOUS LOGON   Account Domain:  NT AUTHORITY   Logon ID:  0x24493567    Object:   Object Server: Security Account Manager   Object Type: SAM_SERVER   Object Name: CN=Server,CN=System,DC=ent,DC=example,DC=com   Handle ID: 0x0    Process Information:   Process ID: 0x9000a000d002d   Process Name: {bf967aad-0de6-11d0-a285-00aa003049e2}      Access Request Information:   Transaction ID: {00000000-0000-0000-0000-000000000000}   Accesses: MAX_ALLOWED         Access Mask: 0x2d   Privileges Used for Access Check:    Properties: Ȁ-   Restricted SID Count: 2949165	208146305
              dictionaryString : """
                SNAREMSGDESC A handle to an object was requested\.
                SRCSECURITYID \S+
                SRCACCOUNTNAME .{1,64}\S
                SRCACCOUNTDOMAIN .*?\S
                SRCLOGONID \S+
                OBJECTSERVER \S.*?\S
                OBJECTTYPE \S+
                OBJECTNAME \S.*?\S
                HANDLEID \S+
                PROCESSID \S+
                PROCESSSNAME \S.*?\S
                ACCESSES \S.*?\S
              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject\s?:\s+Security\sID:\s+%{SRCSECURITYID:sourceSecurityID}\s+Account\sName:\s+%{SRCACCOUNTNAME:sourceUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:sourceNtDomain}\s+Logon\sID:\s+%{SRCLOGONID:sourceLogonID}\s+Object:\s+Object\sServer:\s+%{OBJECTSERVER:destinationObjectServer}\s+Object\sType:\s+%{OBJECTTYPE:destinationObjectType}\s+Object\sName:\s+%{OBJECTNAME:destinationObjectName}\s+Handle\sID:\s+%{HANDLEID:destinationObjectHandle}\s+.*Process\sInformation:\s+Process\sID:\s+%{PROCESSID:sourceProcessID}\s+Process\sName:\s+%{PROCESSSNAME:sourceProcessName}\s+Access\sRequest\sInformation:\s+Transaction\sID:\s+\S+\s+Accesses:\s+%{ACCESSES:desiredAccess}\s+Access\s.*"""
              children : []
            },
            {
              # Security  4727
              # MSWinEventLog	0	Security	1280162	Wed Feb 17 15:26:49 2016	4727	Microsoft-Windows-Security-Auditing	E8SEC\new_global_security_grp	N/A	Success Audit	w2k8r2-AD.e8sec.lab	Security Group Management		A security-enabled global group was created.    Subject:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1104   Account Name:  jyria   Account Domain:  E8SEC   Logon ID:  0xeff5912    New Group:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1136   Group Name:  new_global_security_grp   Group Domain:  E8SEC    Attributes:   SAM Account Name: new_global_security_grp   SID History:  -    Additional Information:   Privileges:  -	1280161
              dictionaryString : """
                SNAREMSGDESC A security-enabled global group was created\.
                SRCSECURITYID \S+
                SRCACCOUNTNAME .{1,64}\S
                SRCACCOUNTDOMAIN .*?\S
                SRCLOGONID \S+
                DSTSECURITYID \S+
                DSTGROUPNAME \S.*?\S
                DSTDOMAIN .*?\S

              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject\s?:\s+Security\sID:\s+%{SRCSECURITYID:sourceSecurityID}\s+Account\sName:\s+%{SRCACCOUNTNAME:sourceUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:sourceNtDomain}\s+Logon\sID:\s+%{SRCLOGONID:sourceLogonID}\s+New\sGroup:\s+Security\sID:\s+%{DSTSECURITYID:destinationGroupSecurityID}\s+Group\sName:\s+%{DSTGROUPNAME:destinationGroup}\s+Group\sDomain:\s+%{DSTDOMAIN:destinationNtDomain}\s+Attributes.*"""
              children : []
            },
            {
              # security 4731
              # MSWinEventLog	0	Security	1280190	Wed Feb 17 15:28:17 2016	4731	Microsoft-Windows-Security-Auditing	E8SEC\new_local_security_grp	N/A	Success Audit	w2k8r2-AD.e8sec.lab	Security Group Management		A security-enabled local group was created.    Subject:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1104   Account Name:  jyria   Account Domain:  E8SEC   Logon ID:  0xeff5912    New Group:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1137   Group Name:  new_local_security_grp   Group Domain:  E8SEC    Attributes:   SAM Account Name: new_local_security_grp   SID History:  -    Additional Information:   Privileges:  -	1280189
              dictionaryString : """
                SNAREMSGDESC A security-enabled local group was created\.
                SRCSECURITYID \S+
                SRCACCOUNTNAME .{1,64}\S
                SRCACCOUNTDOMAIN .*?\S
                SRCLOGONID \S+
                DSTSECURITYID \S+
                DSTGROUPNAME \S.*?\S
                DSTDOMAIN .*?\S

              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject\s?:\s+Security\sID:\s+%{SRCSECURITYID:sourceSecurityID}\s+Account\sName:\s+%{SRCACCOUNTNAME:sourceUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:sourceNtDomain}\s+Logon\sID:\s+%{SRCLOGONID:sourceLogonID}\s+New\sGroup:\s+Security\sID:\s+%{DSTSECURITYID:destinationGroupSecurityID}\s+Group\sName:\s+%{DSTGROUPNAME:destinationGroup}\s+Group\sDomain:\s+%{DSTDOMAIN:destinationNtDomain}\s+Attributes.*"""
              children : []
            },
            {
              # security 4754
              # MSWinEventLog\t0\tSecurity\t1280306\tWed Feb 17 15:30:23 2016\t4754\tMicrosoft-Windows-Security-Auditing\tE8SEC\\new_universal_security_grp\tN/A\tSuccess Audit\tw2k8r2-AD.e8sec.lab\tSecurity Group Management\t\tA security-enabled universal group was created.    Subject:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1104   Account Name:  jyria   Account Domain:  E8SEC   Logon ID:  0xeff5912    Group:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1138   Group Name:  new_universal_security_grp   Group Domain:  E8SEC    Attributes:   SAM Account Name: new_universal_security_grp   SID History:  -    Additional Information:   Privileges:  -\t1280305
              dictionaryString : """
                SNAREMSGDESC A security-enabled universal group was created\.
                SRCSECURITYID \S+
                SRCACCOUNTNAME .{1,64}\S
                SRCACCOUNTDOMAIN .*?\S
                SRCLOGONID \S+
                DSTSECURITYID \S+
                DSTGROUPNAME \S.*?\S
                DSTDOMAIN .*?\S

              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject\s?:\s+Security\sID:\s+%{SRCSECURITYID:sourceSecurityID}\s+Account\sName:\s+%{SRCACCOUNTNAME:sourceUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:sourceNtDomain}\s+Logon\sID:\s+%{SRCLOGONID:sourceLogonID}\s+Group:\s+Security\sID:\s+%{DSTSECURITYID:destinationGroupSecurityID}\s+Group\sName:\s+%{DSTGROUPNAME:destinationGroup}\s+Group\sDomain:\s+%{DSTDOMAIN:destinationNtDomain}\s+Attributes.*"""
              children : []
            },
            {
              # Security 4729
              # MSWinEventLog	0	Security	0	Fri Jul 20 12 29 22 2012 	4729	Microsoft-Windows-Security-Auditing	Carl.Mundy	User	Success Audit	TPAP1CUADCV01.vdsi.ent.example.com	Security Group Management		A member was removed from a security-enabled global group.    Subject:   Security ID:  S-1-5-21-1757981266-413027322-725345543-10177   Account Name:  Carl.Mundy   Account Domain:  VDSI   Logon ID:  0x4063c08b    Member:   Security ID:  S-1-5-21-1757981266-413027322-725345543-24241   Account Name:  CN=Venkatasubbu, Selvakumar X,OU=Users,OU=Accounts,DC=vdsi,DC=ent,DC=example,DC=com    Group:   Security ID:  S-1-5-21-1757981266-413027322-725345543-67988   Group Name:  PA-FW_CR_Proj-126667   Group Domain:  VDSI    Additional Information:   Privileges:  -	229984944
              dictionaryString : """
                SNAREMSGDESC A member was removed from a security-enabled global group\.
                SRCSECURITYID \S+
                SRCACCOUNTNAME .{1,64}\S
                SRCACCOUNTDOMAIN .*?\S
                DSTUSERSECURITYID \S+
                DSTUSERACCOUNTLDAP .*?\S
                SRCLOGONID \S+
                DSTSECURITYID \S+
                DSTGROUPNAME \S.*?\S
                DSTDOMAIN .*?\S

              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject\s?:\s+Security\sID:\s+%{SRCSECURITYID:sourceSecurityID}\s+Account\sName:\s+%{SRCACCOUNTNAME:sourceUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:sourceNtDomain}\s+Logon\sID:\s+%{SRCLOGONID:sourceLogonID}\s+Member:\s+Security\sID:\s+%{DSTUSERSECURITYID:destinationSecurityID}\s+Account\sName:\s+%{DSTUSERACCOUNTLDAP:destinationLdapUser}\s+Group:\s+Security\sID:\s+%{DSTSECURITYID:destinationGroupSecurityID}\s+Group\sName:\s+%{DSTGROUPNAME:destinationGroup}\s+Group\sDomain:\s+%{DSTDOMAIN:destinationGroupNtDomain}\s+Additional.*"""
              children : []
            },
            {
              # Security 4732 4756 4728
              # MSWinEventLog	0	Security	0	Fri Jul 20 15 27 38 2012 	4732	Microsoft-Windows-Security-Auditing	SYSTEM	Well Known Group	Success Audit	tpap1cvcehd01v.abh.ent.example.com	Security Group Management		A member was added to a security-enabled local group.    Subject:   Security ID:  S-1-5-18   Account Name:  TPAP1CVCEHD01V$   Account Domain:  ABH   Logon ID:  0x3e7    Member:   Security ID:  S-1-5-21-1482476501-484061587-839522115-5454   Account Name:  -    Group:   Security ID:  S-1-5-32-545   Group Name:  Users   Group Domain:  Builtin    Additional Information:   Privileges:  -	5640
              # MSWinEventLog	0	Security	1280394	Wed Feb 17 15:33:43 2016	4756	Microsoft-Windows-Security-Auditing	E8SEC\new_universal_security_grp	N/A	Success Audit	w2k8r2-AD.e8sec.lab	Security Group Management		A member was added to a security-enabled universal group.    Subject:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1104   Account Name:  jyria   Account Domain:  E8SEC   Logon ID:  0xeff5912    Member:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1104   Account Name:  CN=jyria,CN=Users,DC=e8sec,DC=lab    Group:   Security ID:  S-1-5-21-1908711140-209524994-2501478566-1138   Account Name:  new_universal_security_grp   Account Domain:  E8SEC    Additional Information:   Privileges:  -	1280393
              dictionaryString : """
                SNAREMSGDESC A member was added to a .*? group\.
                SRCSECURITYID \S+
                SRCACCOUNTNAME .{1,64}\S
                SRCACCOUNTDOMAIN .*?\S
                DSTUSERSECURITYID \S+
                DSTUSERACCOUNTNAME .{1,64}\S
                SRCLOGONID \S+
                DSTSECURITYID \S+
                DSTGROUPNAME \S.*?\S
                DSTDOMAIN .*?\S

              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject\s?:\s+Security\sID:\s+%{SRCSECURITYID:sourceSecurityID}\s+Account\sName:\s+%{SRCACCOUNTNAME:sourceUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:sourceNtDomain}\s+Logon\sID:\s+%{SRCLOGONID:sourceLogonID}\s+Member:\s+Security\sID:\s+%{DSTUSERSECURITYID:destinationSecurityID}\s+Account\sName:\s+(?:-|%{DSTUSERACCOUNTNAME:destinationLdapUser})\s+Group:\s+Security\sID:\s+%{DSTSECURITYID:destinationGroupSecurityID}\s+(?:Group|Account)\sName:\s+%{DSTGROUPNAME:destinationGroup}\s+(?:Group|Account)\sDomain:\s+%{DSTDOMAIN:destinationGroupNtDomain}\s+Additional.*"""
              children : []
            },
            {
              # Security 4733 , 4757
              # MSWinEventLog	0	Security	0	Fri Jul 20 9 6 52 2012 	4733	Microsoft-Windows-Security-Auditing		Unknown	Success Audit	TPAP1LZBECA02V.abh.ent.example.com	Security Group Management		A member was removed from a security-enabled local group.    Subject:   Security ID:  S-1-5-18   Account Name:  TPAP1LZBECA02V$   Account Domain:  ABH   Logon ID:  0x3e7    Member:   Security ID:  S-1-5-21-1757981266-413027322-725345543-85341   Account Name:  -    Group:   Security ID:  S-1-5-32-545   Group Name:  Users   Group Domain:  Builtin    Additional Information:   Privileges:  -	856154
              dictionaryString : """
                SNAREMSGDESC A member was removed from a .*? group\.
                SRCSECURITYID \S+
                SRCACCOUNTNAME .{1,64}\S
                SRCACCOUNTDOMAIN .*?\S
                DSTUSERSECURITYID \S+
                DSTUSERACCOUNTLDAP .*?\S
                SRCLOGONID \S+
                DSTSECURITYID \S+
                DSTGROUPNAME \S.*?\S
                DSTDOMAIN .*?\S

              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject\s?:\s+Security\sID:\s+%{SRCSECURITYID:sourceSecurityID}\s+Account\sName:\s+%{SRCACCOUNTNAME:sourceUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:sourceNtDomain}\s+Logon\sID:\s+%{SRCLOGONID:sourceLogonID}\s+Member:\s+Security\sID:\s+%{DSTUSERSECURITYID:destinationSecurityID}\s+Account\sName:\s+(?:-|%{DSTUSERACCOUNTLDAP:destinationLdapUser})\s+Group:\s+Security\sID:\s+%{DSTSECURITYID:destinationGroupSecurityID}\s+Group\sName:\s+%{DSTGROUPNAME:destinationGroup}\s+Group\sDomain:\s+%{DSTDOMAIN:destinationGroupNtDomain}\s+Additional.*"""
              children : []

            },
            {
              # Security 5140
              # MSWinEventLog	0	Security	0	Fri Jul 20 9 35 40 2012 	5140	Microsoft-Windows-Security-Auditing	TPAP1LVSMS01V$	User	Failure Audit	TPAP1CVRDPA01V.abh.ent.example.com	File Share		A network share object was accessed.     Subject:   Security ID:  S-1-5-21-1482476501-484061587-839522115-23757   Account Name:  TPAP1LVSMS01V$   Account Domain:  ABH   Logon ID:  0x9473274    Network Information:    Object Type:  File   Source Address:  138.83.24.79   Source Port:  3586     Share Information:   Share Name:  \*ADMIN$   Share Path:  ??C:Windows    Access Request Information:   Access Mask:  0x1   Accesses:  ReadData (or ListDirectory)        	22268355
              dictionaryString : """
                SNAREMSGDESC A network share object was accessed\.
                SRCSECURITYID \S+
                SRCACCOUNTNAME .{1,64}\S
                SRCACCOUNTDOMAIN .*?\S
                SRCLOGONID \S+
                OBJECTTYPE \S+
                SRCADDRESS \S+
                SRCPORT \S+
                SHARENAME \S.*?\S

              """
              expr : """%{SNAREMSGDESC:snareMsgDesc}\s+Subject\s?:\s+Security\sID:\s+%{SRCSECURITYID:sourceSecurityID}\s+Account\sName:\s+%{SRCACCOUNTNAME:sourceUserName}\s+Account\sDomain:\s+%{SRCACCOUNTDOMAIN:sourceNtDomain}\s+Logon\sID:\s+%{SRCLOGONID:sourceLogonID}\s+Network\sInformation:\s+Object\sType:\s+%{OBJECTTYPE:destinationObjectType}\s+Source\sAddress:\s+%{SRCADDRESS:sourceNameOrIp}\s+Source\sPort:\s+%{SRCPORT:sourcePort}\s+Share\sInformation:\s+Share\sName:\s+%{SHARENAME:destinationShareName}\s+Share\sPath:.*"""
              children : []

            }

          ]   
        }
      },
      {
        if {
          conditions : [
            { contains { _matchedRuleset : [SnareSecurity] } }
          ]
          then : [
            {
              tryRules {
                catchExceptions : true
                throwExceptionIfAllRulesFailed : true
                rules : [
                  # next rule of tryRules cmd:
                  { commands : [
                    {
                      date2timestamp{
                        inputFieldName : "startTime", 
                        #Thu Apr 24 12:43:48 2014
                        dateFormat : ${windows.date.dateFormat}#"EEE MMM dd HH:mm:ss yyyy",  
                        precision : "ms",
                        timeZone : ${windows.date.timeZone}#"UTC"
                      }
                    }
                    ]
                  },
                  # next rule of tryRules cmd:
                  { commands : [
                    {
                      date2timestamp{
                        inputFieldName : "startTime", 
                        #Thu Apr 24 12:43:48 2014
                        dateFormat : "EEE MMM dd HH mm ss yyyy",  
                        precision : "ms",
                        timeZone : "UTC"
                      }
                    }
                    ]
                  },
                  # if desired, the last rule can serve as a fallback mechanism 
                  # for records that don't match any rule:
                  {
                    commands : [
                      { logWarn { format : "Ignoring record with unsupported input date format format: {}", args : ["@{}"] }}
                      { dropRecord {} }    
                    ]
                  }
                ]
              }
            },
            {
              addKeyValuesIfMissing {
                logSourceType : "IAMMef"
                externalLogSourceType : "MSWinEventLog"
                cefSignatureId : "@{snareSourceName}-@{snareEventId}-@{eventLogType}"
                cefEventName : "@{snareMsgDesc}"
                deviceNameOrIp : "@{snareComputerName}"
                deviceUserName : "@{snareEventUser}"
              }
            },
            {
              validateSupportedFormat  {
                failOnUnknownFields : "false"
                defaultFormat : "IAMMef"
              }
            }
          ]
          else : [
            {
              addKeyValuesIfMissing {
                logSourceType : "UnMatched-IAMMef"
                externalLogSourceType : "MSWinEventLog"
              }
            }
          ]
        }
      }
      ,

    ]
  }
]